{
  "repository": "https://github.com/eungjin-cigro/cursorflow",
  "baseBranch": "main",
  "branchPrefix": "refactor/logging-tests-",
  "executor": "cursor-agent",
  "autoCreatePr": false,
  "allowDependencyChange": false,
  "lockfileReadOnly": true,
  "pollInterval": 60,

  "laneNumber": 2,
  "devPort": 3002,

  "enableReview": true,
  "reviewModel": "gemini-3-flash",
  "maxReviewIterations": 2,

  "dependsOn": ["01-types-tests"],

  "tasks": [
    {
      "name": "extract-logging-code",
      "model": "gemini-3-flash",
      "acceptanceCriteria": [
        "Code snippets extracted from phase-2-logging.md",
        "Extracted files saved to src/services/logging/ directory",
        "Directory structure matches documentation"
      ],
      "prompt": "## Task: Extract Logging Service Code from Documentation\n\n### Goal\nExtract all TypeScript code blocks from the logging refactoring documentation.\n\n### Instructions\n1. Read the documentation:\n   ```bash\n   cat docs/refactoring/phase-2-logging.md\n   ```\n\n2. Create the logging service directory:\n   ```bash\n   mkdir -p src/services/logging\n   ```\n\n3. The documentation contains code for these files:\n   - constants.ts\n   - console.ts\n   - parser.ts\n   - formatter.ts\n   - writer.ts\n   - index.ts\n\n4. Extract code blocks using line numbers. First, find the line numbers:\n   ```bash\n   grep -n '```typescript' docs/refactoring/phase-2-logging.md\n   grep -n 'src/services/logging' docs/refactoring/phase-2-logging.md\n   ```\n\n5. Use sed to extract specific sections. Example pattern:\n   ```bash\n   # Find start and end lines for constants.ts\n   START=$(grep -n 'services/logging/constants.ts' docs/refactoring/phase-2-logging.md | head -1 | cut -d: -f1)\n   # Extract from that line to the next ``` closing\n   sed -n \"${START},/^\\`\\`\\`$/p\" docs/refactoring/phase-2-logging.md | tail -n +3 | head -n -1\n   ```\n\n6. Save each extracted block to its corresponding file:\n   ```bash\n   # Repeat for each file in the documentation\n   ```\n\n7. Verify extraction:\n   ```bash\n   ls -la src/services/logging/\n   wc -l src/services/logging/*.ts\n   ```\n\n### Important\n- Use ONLY terminal commands to extract code\n- DO NOT write code manually\n- Document any extraction issues\n\n### Output\nList all created files with line counts."
    },
    {
      "name": "review-logging-code",
      "model": "gemini-3-flash",
      "acceptanceCriteria": [
        "All files reviewed for completeness",
        "Import paths verified",
        "No missing dependencies",
        "TypeScript compilation passes"
      ],
      "prompt": "## Task: Review Extracted Logging Code\n\n### Goal\nReview extracted logging service code for completeness and correctness.\n\n### Instructions\n1. List extracted files:\n   ```bash\n   find src/services/logging -name '*.ts' | xargs wc -l\n   ```\n\n2. Check TypeScript compilation:\n   ```bash\n   npx tsc --noEmit src/services/logging/*.ts 2>&1 | head -100\n   ```\n\n3. Verify imports are resolvable:\n   ```bash\n   grep -rh '^import' src/services/logging/ | sort | uniq\n   ```\n\n4. Compare file count with documentation:\n   ```bash\n   # Expected files from documentation\n   echo 'Expected: constants.ts, console.ts, parser.ts, formatter.ts, writer.ts, buffer.ts, exporter.ts, manager.ts, index.ts'\n   \n   # Actual files\n   ls src/services/logging/*.ts\n   ```\n\n5. Check for any placeholder code or TODOs:\n   ```bash\n   grep -rn 'TODO\\|FIXME\\|XXX\\|...' src/services/logging/\n   ```\n\n6. Verify index.ts exports:\n   ```bash\n   cat src/services/logging/index.ts\n   ```\n\n### Output\n- Completeness status for each file\n- List of missing or incomplete sections\n- TypeScript errors to fix\n- Recommendations for completion"
    },
    {
      "name": "write-logging-tests",
      "model": "gemini-3-flash",
      "acceptanceCriteria": [
        "Test file created at src/services/logging/__tests__/logging.test.ts",
        "Tests cover constants, console, parser, formatter modules",
        "Tests include unit tests and integration tests",
        "At least 15 test cases"
      ],
      "prompt": "## Task: Write Test Cases for Logging Service\n\n### Goal\nWrite comprehensive test cases for the logging service modules.\n\n### Instructions\n1. Create test directory:\n   ```bash\n   mkdir -p src/services/logging/__tests__\n   ```\n\n2. Review what needs to be tested:\n   ```bash\n   # List all exports from the logging service\n   grep -E '^export' src/services/logging/index.ts\n   \n   # Check what functions are in each file\n   grep -E '^export (function|class|const)' src/services/logging/*.ts\n   ```\n\n3. Create test files for each module:\n\n   **constants.test.ts** - Test color codes, log levels, stripAnsi function\n   ```bash\n   cat > src/services/logging/__tests__/constants.test.ts << 'EOF'\n   import { COLORS, LogLevel, stripAnsi, STATUS_ICONS } from '../constants';\n   \n   describe('Logging Constants', () => {\n     describe('COLORS', () => {\n       it('should have reset color', () => {\n         expect(COLORS.reset).toBe('\\x1b[0m');\n       });\n       \n       it('should have all required colors', () => {\n         expect(COLORS.red).toBeDefined();\n         expect(COLORS.green).toBeDefined();\n         expect(COLORS.yellow).toBeDefined();\n         expect(COLORS.blue).toBeDefined();\n       });\n     });\n     \n     describe('LogLevel', () => {\n       it('should have correct order', () => {\n         expect(LogLevel.error).toBeLessThan(LogLevel.warn);\n         expect(LogLevel.warn).toBeLessThan(LogLevel.debug);\n       });\n     });\n     \n     describe('stripAnsi', () => {\n       it('should remove ANSI codes', () => {\n         const input = '\\x1b[31mRed Text\\x1b[0m';\n         expect(stripAnsi(input)).toBe('Red Text');\n       });\n       \n       it('should handle text without ANSI', () => {\n         expect(stripAnsi('Plain text')).toBe('Plain text');\n       });\n     });\n   });\n   EOF\n   ```\n\n   **parser.test.ts** - Test StreamingMessageParser\n   **formatter.test.ts** - Test formatMessageForConsole\n   **console.test.ts** - Test logging functions\n\n4. Run tests to verify:\n   ```bash\n   npm test -- --testPathPattern=logging --verbose\n   ```\n\n### Output\n- Test file paths created\n- Number of test cases per file\n- Initial test run results"
    },
    {
      "name": "verify-logging-tests",
      "model": "opus-4.5",
      "acceptanceCriteria": [
        "All logging tests pass",
        "Test coverage > 60%",
        "No console errors during tests"
      ],
      "prompt": "## Task: Verify Logging Service Tests\n\n### Goal\nRun and verify all logging service tests.\n\n### Instructions\n1. Check for TypeScript errors:\n   ```bash\n   npx tsc --noEmit src/services/logging/__tests__/*.ts 2>&1\n   ```\n\n2. Run all logging tests:\n   ```bash\n   npm test -- --testPathPattern='services/logging' --verbose\n   ```\n\n3. Generate coverage report:\n   ```bash\n   npm test -- --testPathPattern='services/logging' --coverage --collectCoverageFrom='src/services/logging/**/*.ts'\n   ```\n\n4. Check test results summary:\n   ```bash\n   npm test -- --testPathPattern='services/logging' 2>&1 | grep -E '(Tests:|Suites:|PASS|FAIL)'\n   ```\n\n5. If failures exist, get details:\n   ```bash\n   npm test -- --testPathPattern='services/logging' 2>&1 | grep -A 10 'FAIL\\|âœ•'\n   ```\n\n6. List all test cases:\n   ```bash\n   grep -rh 'it(\\|test(' src/services/logging/__tests__/ | wc -l\n   ```\n\n### Output\n- Total tests: X\n- Passed: X\n- Failed: X\n- Coverage: X%\n- Issues requiring attention"
    }
  ]
}

